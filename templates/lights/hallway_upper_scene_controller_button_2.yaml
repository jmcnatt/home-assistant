---
################################################################################
# Template for upper hallway scene controller button 2 light
# https://www.home-assistant.io/integrations/template/#light
################################################################################
- light:
    - name: "Upper Hallway Scene Controller Button 2 LED Indicator"
      availability: >
        {{ has_value('switch.hallway_upper_scene_controller_button_2_indication') }}
      state: >
        {{ is_state('switch.hallway_upper_scene_controller_button_2_indication', 'on') }}
      turn_on:
        - service: switch.turn_on
          target:
            entity_id: switch.hallway_upper_scene_controller_button_2_indication
      turn_off:
        - service: switch.turn_off
          target:
            entity_id: switch.hallway_upper_scene_controller_button_2_indication
      icon: mdi:led-on
      level: >
        {%- set lvl = states('select.hallway_upper_scene_controller_led_indicator_brightness_button_1') -%}
        {%- if lvl == 'Low (30%)' -%} 85
        {%- elif lvl == 'Medium (60%)' -%} 170
        {%- elif lvl == 'Bright (100%)' -%} 255
        {%- else -%} 0
        {%- endif -%}
      set_level:
        service: select.select_option
        target:
          entity_id: select.hallway_upper_scene_controller_led_indicator_brightness_button_1
        data:
          option: >
            {% if brightness < 64 %}
              Low (30%)
            {% elif brightness < 192 %}
              Medium (60%)
            {% else %}
              Bright (100%)
            {% endif %}
      hs: >
        {% set col = states('select.hallway_upper_scene_controller_led_indicator_color_button_1') %}
        {% if col == 'Red' %} [0,100]
        {% elif col == 'Green' %} [120,100]
        {% elif col == 'Blue' %} [240,100]
        {% elif col == 'White' %} [0,0]
        {% elif col == 'Yellow' %} [60,100]
        {% elif col == 'Cyan' %} [180,100]
        {% elif col == 'Magenta' %} [300,100]
        {% else %} [0,0]
        {% endif %}
      set_hs:
        service: select.select_option
        target:
          entity_id: select.hallway_upper_scene_controller_led_indicator_color_button_1
        data:
          option: >
            {% if hs[1] == 0 %}
              White
            {% elif hs[0] >= 330 or hs[0] < 30 %}
              Red
            {% elif hs[0] >= 30 and hs[0] < 90 %}
              Yellow
            {% elif hs[0] >= 90 and hs[0] < 150 %}
              Green
            {% elif hs[0] >= 150 and hs[0] < 210 %}
              Cyan
            {% elif hs[0] >= 210 and hs[0] < 270 %}
              Blue
            {% elif hs[0] >= 270 and hs[0] < 330 %}
              Magenta
            {% else %}
              White
            {% endif %}
